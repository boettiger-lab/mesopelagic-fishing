---
title: "Diet.description"
output: html_document
---

#Load Libraries
```{r}
library(dplyr)
library(readr)
```

#Define datasets
```{r}
Diet <- read.csv("/Users/sallydowd/Documents/GitHub/mesopelagic-fishing/Data/Diet_CalCur_USE.csv")  
  
predators_of_mesopelagic <- Diet[,c(1,16,19, 29:30, 34, 38:39, 43:49, 51:57, 59:61, 64, 66:68, 70:71, 73:74, 77:81, 83, 86:89)]
mesopelagic.pred <- Diet[15, c(1,16,19, 29:30, 34, 38:39, 43:49, 51:57, 59:61, 64, 66:68, 70:71, 73:74, 77:81, 83, 86:89)]
forage.pred <- Diet[19:27, c(1,16,19, 29:30, 34, 38:39, 43:49, 51:57, 59:61, 64, 66:68, 70:71, 73:74, 77:81, 83, 86:89)]
euphausiids <- Diet[7, c(1,16,19, 29:30, 34, 38:39, 43:49, 51:57, 59:61, 64, 66:68, 70:71, 73:74, 77:81, 83, 86:89)]

species <- as.data.frame(forage.pred$DIETS) %>% mutate(X=1:9) %>% rename("Species"= "forage.pred$DIETS")
#Check if this is right 
forage.pred$MAX <- apply(forage.pred[,-1],1,max)
forage <- as.data.frame(forage.pred$MAX) %>% mutate(X=1:9)
forage <- forage %>% rename("Max diet"= "forage.pred$MAX") %>% left_join(species, by= "X") %>% select(-X)
forage
mesopelagic.pred$MAX <- apply(mesopelagic.pred[,-1],1,max,na.rm=TRUE)
mesopelagic <- as.data.frame(mesopelagic.pred$MAX) %>% rename("Max diet"= "mesopelagic.pred$MAX") %>% mutate("Species"= "mesopelagic fish")
euphausiids$MAX <- apply(euphausiids[,-1],1,max,na.rm=TRUE)
euphausiids <- as.data.frame(euphausiids$MAX) %>% rename("Max diet"= "euphausiids$MAX") %>% mutate("Species"= "euphausiids")

combination <- bind_rows(forage, mesopelagic, euphausiids)
```

#Predators of mesopelagic fish: diet dependence on mesopelagics and forage fish
```{r}
#For each predator of mesopelagic fish find their prey items that make up at least 5% of their diet

test <- list()
for (i in 2:ncol(predators_of_mesopelagic)){
for (j in 1:nrow(predators_of_mesopelagic)){

test[[i]][,i]
}
test

predators_of_mesopelagic[which(predators_of_mesopelagic <= 0.05)] = "NA"
 CalCur_unbal2_list[[i]][[1]][93, 5] <- NA

 #Webplot highlighting predator and prey connections to mesopelagic fish  
webplot(Cal_bal, eco.name= attr(Cal_bal, "California Current"), line.col="grey", labels=TRUE, highlight= "mesopelagics", highlight.col= c("blue", "red", "NA"), label.num=TRUE, label.cex=0.7, fleets=FALSE)

```

